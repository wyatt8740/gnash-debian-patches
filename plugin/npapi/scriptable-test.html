<html>
  <head>
    <title>Gnash: Scriptable Plugin Test</title>
    <style type="text/css" media="screen">
        body, * {font-family:sans-serif;}
        h1 {text-align:center;}
        #extiface_test{background-color:red;}
        #content {}
        #test-actions {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        p {font-family: monospace;}
        #log {
            font-family: monospace;
            width: 800px;
            float:right;
        }
        #log p {
            margin: 0;
            border-bottom:1px solid gray;
        }
        #log h2 a {
            font-style: italic;
            font-weight:normal;
            font-size:12px;
        }
    </style>
  </head>
  <body>
    <h1>Scriptable Plugin testbed</h1>
    <div id="log">
        <h2>Log <a href="#" onclick="clearLog(); return false;">Clear</a></h2>
        
    </div>
    <div id="content">
      
<!-- 
   This next test is a bit hokey, we should really trim down
   the ExternalInterface test to one that's focused on this
   web page. But for now, this gives us a resident player that we
   can bounce XML messages off of.

   To make this work for you, copy or symlink testsuite/Dejagnu.swf and
   testsuite/actionscript.all/ExternalInterface-v8.swf from your build
   tree to your source tree in plugin/npapi/ and add the absolute
   path of this dir to your 'localSandboxPath' variable in
   ~/.gnashpluginrc (for example:
   "append localSandboxPath /usr/src/gnash/b/plugin/npapi).

   You can then attach GDB
   to the PID of gnash running, letting you debug the processing of
   XML messages to and from the browser. For this to work the swf
   files must be in the same directory as the html file.
   
-->
<div>
<object id="extiface_test" data="ExternalInterface-v8.swf"
width="100" height="20" BORDER="1"
type="application/x-shockwave-flash"
pluginspage="http://www.getgnash.org"
>
<param name="movie" value="ExternalInterface-v8.swf">
<param name="AllowScriptAccess" value="always">
</object>

</div>

<!--
   <embed type="application/x-shockwave-flash" width="1" height="1" hidden="true">
-->

    <ul id="test-actions">
      <li><button onclick='ShowVersion()'>Show Version</button></li>
      <li><button onclick='TestJSMethod("foodbar")'>TestJSMethod</button></li>
      <li><button onclick='TestASMethodJS("barfood")'>TestASMethodJS</button></li>
      <li><button onclick='FlashSetVariable("var1", "value"+(val++))'>SetVariable</button></li>
      <li><button onclick='FlashGetVariable("var1")'>GetVariable</button></li>
      <li><button onclick='FlashGotoFrame(123)'>GotoFrame</button></li>
      <li><button onclick='FlashIsPlaying()'>IsPlaying</button></li>
      <li><button onclick='FlashLoadMovie(2, "bogus")'>LoadMovie</button></li>
      <li><button onclick='FlashPan(1, 2, 0)'>Pan</button></li>
      <li><button onclick='FlashPercentLoaded()'>PercentLoaded</button></li>
      <li><button onclick='FlashPlay()'>Play</button></li>
      <li><button onclick='FlashRewind()'>Rewind</button></li>
      <li><button onclick='FlashSetZoomRect(1, 2, 3, 4)'>SetZoomRect</button></li>
      <li><button onclick='FlashStopPlay()'>StopPlay</button></li>
      <li><button onclick='FlashZoom(12)'>Zoom</button></li>
      <li><button onclick='FlashTotalFrames()'>TotalFrames</button></li>
      <li><button onclick='FlashTestASMethod("barby")'>FlashTestASMethod</button></li>
    </ul>

</div>

      <script type="text/javascript">
          var val = 0; // used for setVariable
          var embed = document.getElementById("extiface_test");
          function clearLog() {
              var log = document.getElementById("log");
              log.innerHTML = '<h2>Log <a href="#" onclick="clearLog(); return false;">Clear</a></h2>';
          }
          function addLog(str) {
              var p = document.createElement("P");
              p.innerHTML = str;
              var log = document.getElementById("log");
              log.appendChild(p);
          }
          
          function ShowVersion() {
              var v = '';
              v += "Codebase = " + embed.codebase + "<br>";
              v += "Classid = " + embed.classid + "<br>";
              v += "Plugins page = " + embed.pluginspage + "<br>";
              v += "Src = " + embed["src"] + "<br>";
              v += "BG Color = " + embed.bgcolor + "<br>";
              v += "Quality = " + embed.quality + "<br>";
              v += "movie = " + embed.movie + "<br>";
              // v += "onafterupdate = " + embed.onafterupdate + "<br>";
              // v += "onbeforeupdate = " + embed.onbeforeupdate + "<br>";
              // v += "onblur = " + embed.onblur + "<br>";
              // v += "oncellchange = " + embed.oncellchange + "<br>";
              // v += "onclick = " + embed.onclick + "<br>";
              // v += "ondblClick = " + embed.ondblClick + "<br>";
              // v += "ondrag = " + embed.ondrag + "<br>";
              // v += "ondragend = " + embed.ondragend + "<br>";
              // v += "ondragenter = " + embed.ondragenter + "<br>";
              // v += "ondragleave = " + embed.ondragleave + "<br>";
              // v += "ondragover = " + embed.ondragover + "<br>";
              // v += "ondrop = " + embed.ondrop + "<br>";
              // v += "onfinish = " + embed.onfinish + "<br>";
              // v += "onfocus = " + embed.onfocus + "<br>";
              // v += "onhelp = " + embed.onhelp + "<br>";
              // v += "onmousedown = " + embed.onmousedown + "<br>";
              // v += "onmouseup = " + embed.onmouseup + "<br>";
              // v += "onmouseover = " + embed.onmouseover + "<br>";
              // v += "onmousemove = " + embed.onmousemove + "<br>";
              // v += "onmouseout = " + embed.onmouseout + "<br>";
              // v += "onkeypress = " + embed.onkeypress + "<br>";
              // v += "onkeydown = " + embed.onkeydown + "<br>";
              // v += "onkeyup = " + embed.onkeyup + "<br>";
              // v += "onload = " + embed.onload + "<br>";
              // v += "onlosecapture = " + embed.onlosecapture + "<br>";
              // v += "onpropertychange = " + embed.onpropertychange + "<br>";
              // v += "onreadystatechange = " + embed.onreadystatechange + "<br>";
              // v += "onrowsdelete = " + embed.onrowsdelete + "<br>";
              // v += "onrowenter = " + embed.onrowenter + "<br>";
              // v += "onrowexit = " + embed.onrowexit + "<br>";
              // v += "onrowsinserted = " + embed.onrowsinserted + "<br>";
              // v += "onstart = " + embed.onstart + "<br>";
              // v += "onscroll = " + embed.onscroll + "<br>";
              // v += "onbeforeeditfocus = " + embed.onbeforeeditfocus + "<br>";
              // v += "onactivate = " + embed.onactivate + "<br>";
              // v += "onbeforedeactivate = " + embed.onbeforedeactivate + "<br>";
              // v += "ondeactivate = " + embed.ondeactivate + "<br>";
          
              v += "type = " + embed.type + "<br>";
              v += "id = " + embed.id + "<br>";
              v += "width = " + embed.width + "<br>";
              v += "height = " + embed.height + "<br>";
              v += "align = " + embed.align + "<br>";
              v += "vspace = " + embed.vspace + "<br>";
              v += "hspace = " + embed.hspace + "<br>";
              v += "class = " + embed["class"] + "<br>";
              v += "title = " + embed.title + "<br>";
              v += "accesskey = " + embed.accesskey + "<br>";
              v += "name = " + embed.name + "<br>";
              v += "tabindex = " + embed.tabindex + "<br>";
              v += "FlashVars = " + embed.FlashVars + "<br>";
          
              addLog('Found version is:' + embed.version);
              addLog(v);
          
      }

        function FlashSetVariable(name, value)
        {
            embed.SetVariable(name, value);
        //          addLog("FlashSetVariable");
        }

        function FlashGetVariable(name)
        {
              var value = embed.GetVariable(name);
        //          addLog("Got Variable = " + value);          
              addLog(value);
        }

        function FlashGotoFrame(num)
        {
                  embed.GotoFrame(num);
        //          addLog("GotoFrame<br>");
        //          addLog(value);
        }

        function FlashIsPlaying()
        {
                  var value = embed.IsPlaying();
        //          addLog("IsPlaying() = " + value);          
                  addLog(value);
        }

        function FlashLoadMovie(layer, name)
        {
                  embed.LoadMovie(layer, name);
        //          addLog("LoadMovie()<br>");
        //          addLog("FlashLoadMovie");
        }

        function FlashPan(x, y, mode)
        {
                  embed.Pan(x, y, mode);
        //          addLog("Pan()<br>");
        //          addLog("FlashPan");
        }

        function FlashPercentLoaded()
        {
                  var value = embed.PercentLoaded();
        //          addLog("PercentLoaded() = " + value);          
                  addLog(value);
        }

        function FlashPlay()
        {
                  embed.Play();
        //          addLog("Play()<br>");
        //        addLog("FlashPlay");
        }

        function FlashRewind()
        {
                  embed.Rewind();
        //          addLog("Rewind()<br>");
        //        addLog("FlashRewind");
        }

        function FlashSetZoomRect(left, top, right, bottom)
        {
                  embed.SetZoomRect(left, top, right, bottom);
        //          addLog("SetZoomRect()<br>");
        //        addLog("FlashSetZoomRect");
        }

        function FlashStopPlay()
        {
                  embed.StopPlay();
        //          addLog("StopPlay()<br>");
        //        addLog("FlashStopPlay");
        }

        function FlashZoom(zoom)
        {
                  embed.Zoom(zoom);
        //          addLog("Zoom()<br>");
        //        addLog("FlashZoom");
        }

        function FlashTotalFrames()
        {
                  var value = embed.TotalFrames();
        //          addLog("TotalFrames() = " + value);          
                  addLog(value);
        }

          // This gets call a javascript method
        function TestJSMethod(msg)
          {
                addLog("executed TestJSMethod");
          }

        function FlashTestASMethod(msg)
        {
                  addLog("flashTestASMethod(): enter " + msg);
                  var value = embed.TestASMethod(msg);
                  addLog(value);
                  embed.SetVariable("variable1", 1.1);
                  addLog("flashTestASMethod(): return");         
        }

          // This calls a method in gnash
        function TestASMethodJS(msg)
        {
            addLog("TestASMethod(): enter " + msg);
            var value = embed.TestASMethod(msg);
            addLog(value);
            embed.SetVariable("variable2", 1.1);
//            if (typeof embed.TestASMethod === 'function') {
//                addLog('Running embed.TestASMethod("'+msg+'")');
//                addLog(embed.TestASMethod(msg));
//            } else {
//                addLog("Quitting: embed.TestASMethod is not a function.");
//            }
//          addLog(embed.GetVariable("$version"));
            addLog("TestASMethod(): return ");
        }
</script>

<!--
   This causes this page to do an immediate redirect, but at least then
   we know this is working.
<br>
<object>
<param name="movie" value="geturl.swf"
<embed
src="geturl.swf"
quality="high" wmode="transparent" width="320" height="240"
   type="application/x-shockwave-flash"
   pluginspage="http://www.getgnash.org">
</embed>
-->

<!--
<a href="javascript:;" onclick="window.open('geturl.swf',
	'_selfXX',
	'width=100,height=100,location=yes,resizable=yes');
 return false">GetURL test</a>
-->

</body>
</html>

<!--
local Variables:
indent-tabs-mode: nil
End:
-->
